<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Half Half Plus - Subsidy per Vendor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root {
      /* Half Half Plus inspired palette */
      --hh-blue:#0046ad;
      --hh-blue-light:#4f8df0;
      --hh-green:#46b129;
      --hh-green-light:#9be15d;
      --hh-red:#e53935;
      --bg-soft:#e6f3ff;
      --panel:#ffffff;
      --muted:#7a8496;
    }

    * { box-sizing:border-box; }

    body {
      margin:0;
      padding:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      background:radial-gradient(circle at top left,#ffffff,var(--bg-soft));
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
    }

    .card {
      width:100%;
      max-width:900px;
      background:var(--panel);
      border-radius:18px;
      box-shadow:0 18px 45px rgba(0,0,0,0.18);
      padding:22px 26px 28px;
    }

    .card-header {
      display:flex;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      margin-bottom:14px;
    }

    .title-block h1 {
      margin:0 0 4px;
      font-size:22px;
      color:#0b1220;
      letter-spacing:0.03em;
      text-transform:uppercase;
    }

    .title-block p {
      margin:0;
      font-size:13px;
      color:var(--muted);
    }

    .toggle-group {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }

    button.toggle {
      border-radius:999px;
      border:1px solid rgba(15,23,42,0.16);
      padding:6px 14px;
      font-size:13px;
      background:#f1f5f9;
      color:#0f172a;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      transition:background 0.15s ease,color 0.15s ease,transform 0.1s ease,box-shadow 0.1s ease;
    }

    button.toggle span.dot {
      width:8px;
      height:8px;
      border-radius:999px;
      background:var(--hh-blue);
    }

    button.toggle.alt span.dot {
      background:var(--hh-green);
    }

    button.toggle.active {
      background:#0046ad;
      background:linear-gradient(135deg,var(--hh-blue),var(--hh-green));
      color:#f9fafb;
      border-color:transparent;
      box-shadow:0 0 0 1px rgba(15,23,42,0.12);
      transform:translateY(-1px);
    }

    button.toggle:focus-visible {
      outline:2px solid var(--hh-blue);
      outline-offset:2px;
    }

    .legend {
      display:flex;
      flex-wrap:wrap;
      gap:16px;
      align-items:center;
      margin-bottom:4px;
    }

    .legend-item {
      display:flex;
      align-items:center;
      gap:6px;
      font-size:11px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:0.08em;
    }

    .swatch {
      width:14px;
      height:14px;
      border-radius:4px;
    }

    .swatch.total {
      background:linear-gradient(135deg,var(--hh-blue),var(--hh-blue-light));
    }

    .swatch.monthly {
      background:linear-gradient(135deg,var(--hh-green),var(--hh-green-light));
    }

    canvas {
      max-height:420px;
    }

    @media (max-width:640px) {
      .card { padding:18px 16px 22px; }
      .title-block h1 { font-size:18px; }
    }
  </style>
</head>
<body>
<div class="card">
  <div class="card-header">
    <div class="title-block">
      <h1>Subsidy per Vendor by Quintile</h1>
      <p id="subtitle">All phases combined - baht per vendor</p>
    </div>
    <div class="toggle-group">
      <button class="toggle active" id="btn-total">
        <span class="dot"></span>
        Total per vendor
      </button>
      <button class="toggle alt" id="btn-monthly">
        <span class="dot"></span>
        Average per month per vendor
      </button>
    </div>
  </div>

  <div class="legend">
    <div class="legend-item">
      <span class="swatch total"></span>
      <span>Total subsidy per vendor</span>
    </div>
    <div class="legend-item">
      <span class="swatch monthly"></span>
      <span>Monthly subsidy per vendor (mock)</span>
    </div>
  </div>

  <canvas id="subsidyChart"></canvas>
</div>

<script>
  const ctx = document.getElementById("subsidyChart").getContext("2d");

  // Order top to bottom: Fifth - First
  const quintiles = ["Fifth","Fourth","Third","Second","First"];

  // Baht per vendor, all phases combined (already per vendor)
  const totalSubsidy = [578494,126021,51588,19783,4163];

  // Mock participation months per vendor in each quintile (varies by vendor)
  const monthsPerVendor = [10,8,7,6,5];
  const monthlySubsidy = totalSubsidy.map((v,i) => v / monthsPerVendor[i]);

  // Gradients that match the theme and legend
  function makeBlueGradient() {
    const g = ctx.createLinearGradient(0,0,800,0);
    g.addColorStop(0,"#0046ad");
    g.addColorStop(1,"#4f8df0");
    return g;
  }

  function makeGreenGradient() {
    const g = ctx.createLinearGradient(0,0,800,0);
    g.addColorStop(0,"#46b129");
    g.addColorStop(1,"#9be15d");
    return g;
  }

  let currentMode = "total";

  const chartConfig = {
    type:"bar",
    data:{
      labels:quintiles,
      datasets:[{
        label:"Baht per vendor",
        data:totalSubsidy,
        backgroundColor:makeBlueGradient(),
        borderColor:"#0f172a",
        borderWidth:1.2,
        borderRadius:7,
        barThickness:26,
        hoverBackgroundColor:makeBlueGradient()
      }]
    },
    options:{
      indexAxis:"y",
      responsive:true,
      maintainAspectRatio:false,
      layout:{ padding:{ left:0,right:10,top:4,bottom:2 } },
      scales:{
        x:{
          beginAtZero:true,
          grid:{ color:"rgba(148,163,184,0.35)" },
          ticks:{
            color:"#64748b",
            callback:value => value.toLocaleString("en-US")
          },
          title:{
            display:true,
            text:"Baht per vendor (all phases combined)",
            color:"#0f172a",
            font:{ size:12,weight:"600" }
          }
        },
        y:{
          grid:{ display:false },
          ticks:{
            color:"#0f172a",
            font:{ weight:"600" }
          }
        }
      },
      plugins:{
        legend:{ display:false },
        tooltip:{
          callbacks:{
            label:function(context){
              const v = context.raw;
              const label =
                currentMode === "total"
                ? " baht per vendor"
                : " baht per vendor per month (avg, mock)";
              return " " + v.toLocaleString("en-US",{maximumFractionDigits:0}) + label;
            }
          }
        }
      },
      animation:{ duration:450,easing:"easeOutQuad" }
    }
  };

  const subsidyChart = new Chart(ctx,chartConfig);

  const btnTotal = document.getElementById("btn-total");
  const btnMonthly = document.getElementById("btn-monthly");
  const subtitle = document.getElementById("subtitle");

  function setMode(mode) {
    currentMode = mode;

    if (mode === "total") {
      subsidyChart.data.datasets[0].data = totalSubsidy;
      subsidyChart.data.datasets[0].backgroundColor = makeBlueGradient();
      subsidyChart.data.datasets[0].hoverBackgroundColor = makeBlueGradient();
      subsidyChart.options.scales.x.title.text =
        "Baht per vendor (all phases combined)";
      subtitle.textContent = "All phases combined - baht per vendor";
      btnTotal.classList.add("active");
      btnMonthly.classList.remove("active");
    } else {
      subsidyChart.data.datasets[0].data = monthlySubsidy;
      subsidyChart.data.datasets[0].backgroundColor = makeGreenGradient();
      subsidyChart.data.datasets[0].hoverBackgroundColor = makeGreenGradient();
      subsidyChart.options.scales.x.title.text =
        "Baht per vendor per month (average, mock data)";
      subtitle.textContent =
        "Average per month per vendor - months vary by vendor (mock data)";
      btnMonthly.classList.add("active");
      btnTotal.classList.remove("active");
    }

    subsidyChart.update();
  }

  btnTotal.addEventListener("click", () => setMode("total"));
  btnMonthly.addEventListener("click", () => setMode("monthly"));
</script>
</body>
</html>
